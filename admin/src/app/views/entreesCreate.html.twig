{% extends 'layout.html.twig' %}

{% block content %}
    <h1>Créer une entrée</h1>
    <form action="{{ url_for('entrees.create.post') }}" method="post">
        <label for="firstname">Prénom</label>
        <input type="text" name="firstname" id="firstname" required>
        <label for="lastname">Nom</label>
        <input type="text" name="lastname" id="lastname" required>
        <label for="fonction">Fonction</label>
        <input type="text" name="fonction" id="fonction" required>
        <label for="Desktop">Numéro de Bureau</label>
        <input type="number" name="Desktop" id="Desktop" required>

        <label for="phone1">Numéro de Téléphone 1</label>
        <input type="tel" name="phone1" id="phone1" required>
        <label for="phone2">Numéro de Téléphone 2</label>
        <input type="tel" name="phone2" id="phone2" disabled>

        <label for="email">Email</label>
        <input type="email" name="email" id="email" required>

        <div id="departments">
            <label for="department1">Département 1</label>
            <input type="text" name="departments[]" id="department1" class="department-field">
        </div>
        <input type="hidden" name="csrf" value="{{ csrf }}">
        <button type="button" id="add-department">Ajouter un département</button>

        <button type="submit">Créer</button>
    </form>



    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const phoneInputs = document.querySelectorAll('input[type="tel"]');
            phoneInputs.forEach(input => {
                const iti = intlTelInput(input, {
                    initialCountry: "fr",
                    onlyCountries: ["fr", "us", "gb", "de", "it", "es"], // Ajoutez les pays nécessaires ici
                    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
                });

                input.addEventListener('input', function() {
                    if (!iti.isValidNumber()) {
                        input.setCustomValidity('Numéro de téléphone invalide.');
                    } else {
                        input.setCustomValidity('');
                    }
                });
            });

            let departmentCount = 1;
            document.getElementById('add-department').addEventListener('click', function() {
                departmentCount++;
                const departmentDiv = document.getElementById('departments');

                const newDepartmentLabel = document.createElement('label');
                newDepartmentLabel.setAttribute('for', 'department' + departmentCount);
                newDepartmentLabel.textContent = 'Département ' + departmentCount;

                const newDepartmentInput = document.createElement('input');
                newDepartmentInput.setAttribute('type', 'text');
                newDepartmentInput.setAttribute('name', 'departments[]');
                newDepartmentInput.setAttribute('id', 'department' + departmentCount);
                newDepartmentInput.classList.add('department-field');

                departmentDiv.appendChild(newDepartmentLabel);
                departmentDiv.appendChild(newDepartmentInput);
            });

            const phone1Input = document.getElementById('phone1');
            const phone2Input = document.getElementById('phone2');

            phone1Input.addEventListener('input', function() {
                if (phone1Input.value.trim() === "") {
                    phone2Input.value = "";
                    phone2Input.disabled = true;
                } else {
                    phone2Input.disabled = false;
                }
            });

            if (phone1Input.value.trim() === "") {
                phone2Input.disabled = true;
            }
        });
    </script>
{% endblock %}
